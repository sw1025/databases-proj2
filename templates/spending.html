<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title> Past Spending </title>
    
    <link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/thumb/6/69/How_to_use_icon.svg/1200px-How_to_use_icon.svg.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.5.0/chart.min.js" integrity="sha512-n/G+dROKbKL3GVngGWmWfwK0yPctjZQM752diVYnXZtD/48agpUKLIn0xDQL9ydZ91x6BiOmTIFwWjjFi2kEFg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400&display=swap" rel="stylesheet">
    
  </head>
  <body>
    <nav>
      <ul>
        <li class = "navTitle"> <a href="{{ url_for('home') }}">  Home </a>
        </li>
        <li class = "navTitle"> <a href="{{ url_for('flight_search') }}">  Flight Search </a>
        </li>
      </ul>
    </nav>
    {# {% if 'username' in session %}
      {% if session['acc_type'] == 'customer'%}
        <li class = "navTitle"> <a href="{{url_for('purchased_flights')}}"> Purchased Flights </a> </li>
        <li class = "navTitle"> <a href="{{url_for('flight_search')}}"> Flight Search </a> </li>
        <li class = "navTitle"> <a href="{{url_for('spending')}}"> Past Spending </a> </li>
      {% if session['acc_type'] == 'agent'%}
      {% if session['acc_type'] == 'staff'%}
    {%endif%} #}
    <h1> Past Spending </h1>

    {% if spent%}
        <ul>
        {% for s in spent %}
        <li>Ticket ID:{{ s['ticket_id'] }} </li>
        <br>
        <li>Price Date: {{ s['purchase_date'] }} </li>
        <br>
        <li>Price$: {{ s['purchase_price'] }} </li>
        <br>
        <p> --- </p>
        <br>
        <br>
        {%endfor%}
        </ul>
    {% endif%}

    <form action = "/spending" method = "POST">
      <p>Specify Date Range</p>
      <p>Date Range Start</p> <input type="date" name = "start_date"> 
      <p>Date Range Start</p> <input type="date" name = "end_date">
      <button type="submit"> Submit </button>
    </form>
    <br>
    <p> Total Spent (Last 12 Months): {{total}}</p>
    <h4> Spending (Last 6 Months)</h4>

<div style="width: 600px;">
  <canvas id="myChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

{%block javascript%}
<script>
  const ctx = document.getElementById('myChart');

  const chartLabels = {{ months | tojson }};
  const chartData = {{ amounts | tojson }};

  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: chartLabels,
      datasets: [{
        label: 'Monthly Spending',
        data: chartData,
        borderWidth: 1
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>
{% endblock javascript%}
    
    <br>
    <a href="{{url_for('cust_dashboard')}}"> Back to Dashboard </a>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
  </body>
</html>